<template>
    <div class="container">
      <!-- ä¾§è¾¹æ æŒ‰é’® -->
      <div class="sidebar-button">
        <button v-if="!hideButtons.includes('æ¨¡å‹')" class="menu-button model-button"
          @click="setActiveContent('æ¨¡å‹')">æ¨¡å‹</button>
        <button v-if="!hideButtons.includes('äººä½“æ¨¡å‹')" class="menu-button model-button"
          @click="setActiveContent('äººä½“æ¨¡å‹')">äººä½“æ¨¡å‹</button>
        <button v-if="!hideButtons.includes('åœºæ™¯æ¨¡å‹')" class="menu-button model-button"
          @click="setActiveContent('åœºæ™¯æ¨¡å‹')">åœºæ™¯æ¨¡å‹</button>
        <button v-if="!hideButtons.includes('é©±åŠ¨')" class="menu-button drive-button"
          @click="setActiveContent('é©±åŠ¨')">é©±åŠ¨</button>
        <button v-if="!hideButtons.includes('å…‰ç…§')" class="menu-button lighting-button"
          @click="setActiveContent('å…‰ç…§')">å…‰ç…§</button>
      </div>
  
      <!-- åŠ¨æ€æ˜¾ç¤ºçš„å†…å®¹åŒºåŸŸ -->
      <div class="content">
        <!-- å†…å®¹å®¹å™¨ -->
        <div v-if="activeContent === 'æ¨¡å‹'" class="content-container">
          <!-- é¡¶éƒ¨æŒ‰é’®æ  -->
  
          <div class="top-buttons">
            <button :class="{ active: activeModelTab === 'é‡å»º' }" @click="setActiveModelTab('é‡å»º')">
              é‡å»º
            </button>
            <button :class="{ active: activeModelTab === 'èµ„äº§' }" @click="setActiveModelTab('èµ„äº§')">
              èµ„äº§
            </button>
          </div>
  
  
          <!-- é‡å»ºå†…å®¹ -->
          <div v-if="activeModelTab === 'é‡å»º'" class="extra-functions">
  
            <p style="font-size: 13px;text-align: center;">ä¸€æ®µè§†é¢‘é‡å»ºä½ çš„ä¸‰ç»´æ•°å­—åœºæ™¯ï¼</p>
            <div class="drag-drop-area" @dragover.prevent @drop.prevent="handleImageDrop">
              <div class="icon-container">
                <span class="icon">ğŸ–¼</span>
                <p>ä¸Šä¼ å›¾ç‰‡æˆ–è€…è§†é¢‘</p>
              </div>
            </div>
            <button class="train-button" @click="handleTrainClick">ä¸€é”®è®­ç»ƒ</button>
  
          </div>
  
          <!-- èµ„äº§å†…å®¹ -->
          <div v-if="activeModelTab === 'èµ„äº§'" class="asset-content">
            <div class="sidebar">
              <div class="category" v-for="category in modelCategories" :key="category.title">
                <div class="uptitle">
                  <h2>{{ category.title }}</h2>
                </div>
                <div class="buttons">
                  <button v-for="button in category.buttons" :key="button.name" class="button"
                    @click="handleButtonClick(button)">
                    {{ button.name }}
                  </button>
                </div>
              </div>
            </div>
          </div>
  
        </div>
  
        <!-- <div v-if="activeContent === 'é©±åŠ¨'" class="content-container">
            
            <div class="top-buttons">
            <button
              :class="{ active: activeModelTab === 'è¡¨æƒ…' }"
              @click="setActiveModelTab('è¡¨æƒ…')"
            >
              è¡¨æƒ…
            </button>
            <button
              :class="{ active: activeModelTab === 'è‚¢ä½“' }"
              @click="setActiveModelTab('è‚¢ä½“')"
            >
              è‚¢ä½“
            </button>
            </div>
            
            <div v-if="activeModelTab === 'è¡¨æƒ…'" class="asset-content">
                <div class="sidebar">
                   <div
                class="category"
                v-for="category in faceCategories"
                :key="category.title"
              >
                <div class="uptitle">
                  <h2>{{ category.title }}</h2>
                </div>
                <div class="buttons">
                  <button
                    v-for="button in category.buttons"
                    :key="button.name"
                    class="button"
                    @click="handleButtonClick(button.path)"
                  >
                    {{ button.name }}
                  </button>
                </div>
                    </div>
  
                    <div class="image-preview">
                  <h2>è¡¨æƒ…é¢„è§ˆ</h2>
                  <video controls autoplay muted loop class="preview-image">
                    
                    <source src="/è¡¨æƒ….mp4" type="video/mp4" class="preview-image" />
                  </video>
                    </div>
                </div>
                
            </div>
           
            <div v-if="activeModelTab === 'è‚¢ä½“'" class="asset-content">
            <div class="sidebar">
              <div
                class="category"
                v-for="category in bodyCategories"
                :key="category.title"
              >
                <div class="uptitle">
                  <h2>{{ category.title }}</h2>
                </div>
                <div class="buttons">
                  <button
                    v-for="button in category.buttons"
                    :key="button.name"
                    class="button"
                    @click="handleButtonClick(button.path)"
                  >
                    {{ button.name }}
                  </button>
                </div>
              </div>
  
              <div class="image-preview">
            <h2>åŠ¨ä½œé¢„è§ˆ</h2>
            <video controls autoplay muted loop class="preview-image">
             
              <source src="/åŠ¨ä½œ.mp4" type="video/mp4" class="preview-image" />
            </video>
              </div>
            </div>
            </div>
  
            
  
  
  
          </div> -->
  
        <div v-if="activeContent === 'é©±åŠ¨'" class="content-container">
  
          <div class="top-buttons">
            <button :class="{ active: activeModelTab === 'åŠ¨ä½œ' }" @click="setActiveModelTab('åŠ¨ä½œ')">
              åŠ¨ä½œ
            </button>
            <button :class="{ active: activeModelTab === 'éŸ³é¢‘' }" @click="setActiveModelTab('éŸ³é¢‘')">
              éŸ³é¢‘
            </button>
          </div>
          <!-- è¡¨æƒ…å†…å®¹ -->
          <div v-if="activeModelTab === 'åŠ¨ä½œ'" class="asset-content">
            <div class="sidebar">
              <div class="category" v-for="category in faceCategories" :key="category.title">
                <div class="uptitle">
                  <h2>{{ category.title }}</h2>
                </div>
                <div class="buttons">
                  <button v-for="button in category.buttons" :key="button.name" class="button"
                    @click="handleButtonClick(button)">
                    {{ button.name }}
                  </button>
                </div>
              </div>
  
              <div class="image-preview">
                <h2>è¡¨æƒ…é¢„è§ˆ</h2>
                <video controls autoplay muted loop class="preview-image">
                  <!-- æ›¿æ¢ä¸ºå›¾ç‰‡å†…å®¹ -->
                  <source src="/è¡¨æƒ….mp4" type="video/mp4" class="preview-image" />
                </video>
              </div>
            </div>
  
          </div>
          <!-- è‚¢ä½“å†…å®¹ -->
          <div v-if="activeModelTab === 'éŸ³é¢‘'" class="asset-content">
            <div class="sidebar">
              <div class="category" v-for="category in bodyCategories" :key="category.title">
                <div class="buttons">
                  <button v-for="button in category.buttons" :key="button.name" class="button"
                    @click="handleButtonClick(button)">
                    {{ button.name }}
                  </button>
                </div>
              </div>
  
              <!-- ä¸Šä¼ éŸ³é¢‘éƒ¨åˆ† -->
              <div class="audio-upload">
                <input type="file" accept="audio/*" id="audioUpload" style="display: none;" @change="handleAudioUpload" />
                <label for="audioUpload" class="upload-audio-button">
                  <span class="button-text">ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶</span>
                </label>
  
                <!-- éŸ³é¢‘é¢„è§ˆæ¡† -->
                <div v-if="audioPreviewUrl" class="audio-preview">
               
                  <audio controls>
                    <source :src="audioPreviewUrl" type="audio/mpeg" />
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                  </audio>
                </div>
              </div>
  
              <!-- åŠ¨ä½œé¢„è§ˆéƒ¨åˆ† -->
              <div class="image-preview">
                <h2>åŠ¨ä½œé¢„è§ˆ</h2>
                <video controls autoplay muted loop class="preview-image">
                  <source src="/åŠ¨ä½œ.mp4" type="video/mp4" />
                </video>
              </div>
            </div>
          </div>
  
        </div>
  
        <div v-if="activeContent === 'å…‰ç…§'" class="content-container">
          <div class="sidebar">
            <div class="category" v-for="category in lightingCategories" :key="category.title">
              <div class="uptitle">
                <h2>{{ category.title }}</h2>
              </div>
              <div class="buttons">
                <button v-for="button in category.buttons" :key="button" class="button">
                  {{ button }}
                </button>
              </div>
            </div>
  
            <UploadPreviewComponent :storedTexture="storedTexture" @update-texture="handleTextureUpdate" />
          </div>
        </div>
  
  
        <functions1 :buttonLabels="functionButtonLabels" />
  
        <div class="upload-container">
          <input type="file" accept=".ply" id="plyUpload" style="display: none;" @change="handlePlyUpload" />
          <label for="plyUpload" class="upload-button">
            <span class="button-text">ä¸Šä¼ .plyæ–‡ä»¶</span>
          </label>
        </div>
  
  
  
      </div>
  
    </div>
  </template>
    
  <script>
  import UploadPreviewComponent from "./uploadlight.vue";
  import functions1 from "./functionsidebar.vue"
  export default {
    props: {
      hideButtons: {
        type: Array,
        default: () => [], // é»˜è®¤ä¸éšè—ä»»ä½•æŒ‰é’®
      },
      modelCategories: {
        type: Array,
        required: true,
      },
      faceCategories: {
        type: Array,
        required: true,
      },
      bodyCategories: {
        type: Array,
        required: true,
      },
      driveCategories: {
        type: Array,
        required: true,
      },
      lightingCategories: {
        type: Array,
        required: true,
      },
      hideButtons: {
        type: Array,
        default: () => [],
      },
    },
    data() {
      return {
        activeContent: "æ¨¡å‹", // å½“å‰æ¿€æ´»çš„å†…å®¹
        storedTexture: null, // å­˜å‚¨ä¸Šä¼ çš„çº¹ç†æ•°æ®
        activeModelTab: 'é‡å»º', // é»˜è®¤æ¿€æ´»çš„æ ‡ç­¾
        audioPreviewUrl: '/audio.wav', // éŸ³é¢‘é¢„è§ˆ URL
        functionButtonLabels: {
          headRefine: "ç‰©ä½“ç¼–è¾‘", // å¤´éƒ¨ç»†åŒ–æŒ‰é’®åç§°
          stylize: "é£æ ¼åŒ–", // é£æ ¼åŒ–æŒ‰é’®åç§°
        },
      };
    },
    components: {
      UploadPreviewComponent,
      functions1
    },
    methods: {
  
      handleAudioUpload(event) {
      const file = event.target.files[0];
      if (file) {
        this.audioPreviewUrl = URL.createObjectURL(file); // ç”ŸæˆéŸ³é¢‘é¢„è§ˆ URL
      }
    },
      setActiveContent(name) {
        this.activeContent = name; // æ›´æ–°å½“å‰æ˜¾ç¤ºçš„å†…å®¹
        if (name === "æ¨¡å‹") {
          this.activeModelTab = "é‡å»º"; // é»˜è®¤åˆ‡æ¢åˆ°èµ„äº§å­é¡µé¢
        }
        if (name === "é©±åŠ¨") {
          this.activeModelTab = "åŠ¨ä½œ"; // é»˜è®¤åˆ‡æ¢åˆ°èµ„äº§å­é¡µé¢
        }
      },
      setActiveModelTab(tabName) {
        this.activeModelTab = tabName; // åˆ‡æ¢é‡å»ºå’Œèµ„äº§
      },
      handleTextureUpdate(texture) {
        this.storedTexture = texture; // æ›´æ–°å­˜å‚¨çš„çº¹ç†æ•°æ®
      },
      handlePlyUpload(event) {
        const file = event.target.files[0];
        if (file) {
          alert(`Uploaded PLY file: ${file.name}`);
        }
      },
      handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
          if (file.type.startsWith("image/")) {
            alert(`Uploaded image: ${file.name}`);
          } else {
            alert("Please upload a valid image file!");
          }
        }
      },
      handleImageDrop(event) {
        const files = event.dataTransfer.files;
        if (files.length > 0) {
          const file = files[0];
          alert(`Dropped image file: ${file.name}`);
        }
      },
      handleButtonClick(button) {
        // å‘çˆ¶ç»„ä»¶è§¦å‘äº‹ä»¶ï¼Œå¹¶ä¼ é€’è·¯å¾„
        console.log("Emitting path:", button.path); // æ·»åŠ è°ƒè¯•æ—¥å¿—
        // this.$emit("update-splat-scene", path);
        this.$emit("update-splat-scene", {
        path: button.path,
        cameraOptions: button.cameraOptions || null, // ç¡®ä¿å…¼å®¹æ²¡æœ‰ cameraOptions çš„æŒ‰é’®
      });
      },
    },
  };
  </script>
    
    
    
  <style scoped>
  /* æ€»å®¹å™¨æ ·å¼ */
  .container {
    display: flex;
    height: 100vh;
    /* ç¡®ä¿ä¸»å®¹å™¨å æ»¡æ•´ä¸ªå±å¹• */
    width: 18%;
    justify-content: flex-start;
  
  
  }
  
  /* ä¾§è¾¹æ æŒ‰é’®æ ·å¼ */
  .sidebar-button {
  
    top: 0;
    left: 0;
    width: 15%;
    height: 100%;
    display: flex;
    flex-direction: column;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
  }
  
  /* æŒ‰é’®æ ·å¼ */
  .menu-button {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-weight: bold;
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    writing-mode: vertical-rl;
    text-orientation: upright;
  }
  
  .model-button {
    background-color: rgb(165, 171, 178);
  }
  
  .drive-button {
    background-color: rgb(78, 79, 80);
  }
  
  .lighting-button {
    background-color: rgb(117, 117, 117);
  }
  
  .human-button {
    background-color: #e91e63;
  }
  
  /* é¼ æ ‡æ‚¬åœæ•ˆæœ */
  .menu-button:hover {
    opacity: 0.8;
  }
  
  /* å†…å®¹åŒºåŸŸæ ·å¼ */
  .content {
    width: 85%;
    flex-direction: column;
    margin-left: 0px;
    /* ä¿®æ”¹ä¸ºä¸ä¾§è¾¹æ å®½åº¦ä¸€è‡´ */
  
    flex: 1;
    display: flex;
    background-color: #dbdada;
    justify-content: center;
    align-items: center;
    border-radius: 5px;
  
  }
  
  /* åŠ¨æ€å†…å®¹å®¹å™¨ */
  .content-container {
    width: 90%;
    height: 80%;
    /* é«˜åº¦ç­‰äºæ•´ä¸ªè§†å£é«˜åº¦ */
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    justify-content: flex-start;
    /* æ°´å¹³æ–¹å‘å±…ä¸­ */
    align-items: center;
    /* å‚ç›´æ–¹å‘å±…ä¸­ */
    background-color: #ffffff;
    overflow-y: auto;
    /* å¦‚æœå†…å®¹è¶…å‡ºé«˜åº¦ï¼Œå…è®¸æ»šåŠ¨ */
    padding: 7px;
  
    margin-bottom: 5%;
    margin-top: 3%;
    border-radius: 5px;
  
  
  }
  
  .asset-content {
    height: 85%;
  }
  
  /* sidebar æ ·å¼ */
  .sidebar {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    align-items: center;
  
  
  
  }
  
  .category {
    display: flex;
    flex-direction: column;
    width: 100%;
  
    margin-bottom: 20px;
    justify-content: center;
    align-items: center;
  
  }
  
  .uptitle {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 10px;
    width: 85%;
    height: 50%;
    background-color: rgb(165, 171, 178);
    border-radius: 12px;
    margin-top: 10px;
  
  }
  
  .uptitle h2 {
    font-size: 16px;
  }
  
  .buttons {
    display: flex;
    flex-wrap: wrap;
    width: 100%;
    align-items: center;
    justify-content: center;
  }
  
  .category button {
    padding: 10px;
    margin: 5px;
    width: 40%;
    height: 40px;
    background-color: #fdfdfd;
    border: 1px solid #e0e0e0;
    border-radius: 15px;
    cursor: pointer;
  }
  
  .category button:hover {
    background-color: #f0f0f0;
    border-color: #bbb;
  }
  
  /* é¢å¤–åŠŸèƒ½åŒºåŸŸæ ·å¼ */
  .extra-functions {
  
    height: 60%;
    width: 95%;
    margin-top: 38%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  
  
  
  }
  
  .train-button {
    margin-top: 20px;
    /* æŒ‰é’®ä¸ä¸Šæ–¹å†…å®¹çš„é—´è· */
    width: 60%;
    /* æŒ‰é’®å®½åº¦å¡«æ»¡å®¹å™¨ */
    padding: 10px;
    /* æŒ‰é’®å†…è¾¹è· */
    font-size: 14px;
    /* æŒ‰é’®æ–‡å­—å¤§å° */
    font-weight: bold;
    /* åŠ ç²—æ–‡å­— */
    color: white;
    /* æŒ‰é’®æ–‡å­—é¢œè‰² */
    background-color: #3b3d3f;
    /* æŒ‰é’®èƒŒæ™¯è‰² */
    border: none;
    /* ç§»é™¤è¾¹æ¡† */
    border-radius: 8px;
    /* åœ†è§’ */
    cursor: pointer;
    /* é¼ æ ‡æ‚¬åœæ—¶å˜æˆæ‰‹å‹ */
    transition: background-color 0.3s ease;
    /* åŠ¨æ€æ•ˆæœ */
  }
  
  .train-button:hover {
    background-color: #005a9e;
    /* æ‚¬åœæ—¶çš„æŒ‰é’®èƒŒæ™¯è‰² */
  }
  
  /* ä¸Šä¼ æŒ‰é’®æ ·å¼ */
  .upload-container {
    width: 90%;
    height: 7%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  
  
  }
  
  .upload-button {
    width: 95%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 15px;
    color: #fff;
    background-color: #2b3a4a;
    border: 2px solid #fff;
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 1px;
  }
  
  .upload-button:hover {
    background-color: #3c4d5e;
  }
  
  .upload-container p {
    color: #de4f4f;
    font-size: 14px;
  }
  
  /* æ‹–æ‹½åŒºåŸŸæ ·å¼ */
  .drag-drop-area {
    width: 95%;
    height: 60%;
    background-color: #2b3a4a;
    border: 2px dashed #fff;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.3s;
  
  }
  
  .drag-drop-area:hover {
    background-color: #3c4d5e;
  }
  
  .icon-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
  }
  
  .icon {
    font-size: 30px;
  }
  
  .icon-container p {
    margin-top: 5px;
    font-size: 14px;
  }
  
  .audio-upload {
    display: flex;
    flex-direction: column;
    width: 80%;
    height: 20%;
    margin-bottom: 15px;
    align-items: center;
    justify-content: space-between;
  }
  
  .upload-audio-button {
    width: 95%;
    height: 30%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 15px;
    color: #fff;
    background-color: #2b3a4a;
    border: 2px solid #fff;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 1px;
    font-size: 13px;
  }
  
  .audio-preview {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 130%;
    height: 60%
  }
  
  .audio-preview h3 {
  
    margin-bottom: 5px;
  }
  
  audio {
    width: 100%; /* éŸ³é¢‘æ§ä»¶å æ»¡çˆ¶å®¹å™¨å®½åº¦ */
    height: 65%;
    max-width: 300px; /* é™åˆ¶æœ€å¤§å®½åº¦ */
  }
  
  
  
  .image-preview {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 95%;
    height: 50%;
    gap: 10px;
  
  
    overflow: hidden;
    /* éšè—è¶…å‡ºèŒƒå›´çš„å†…å®¹ */
  }
  
  .image-preview video {
    width: 100%;
    /* åŒ¹é…çˆ¶å®¹å™¨å®½åº¦ */
    height: 100%;
    /* åŒ¹é…çˆ¶å®¹å™¨é«˜åº¦ */
    object-fit: cover;
    /* ç¡®ä¿è§†é¢‘ç¼©æ”¾æ—¶ä¿æŒæ¯”ä¾‹ */
  }
  
  
  .image-preview h2 {
    font-size: 16px;
    margin: 0;
  }
  
  .preview-image {
    width: 98%;
    height: 100%;
    object-fit: cover;
    /* ç¡®ä¿å›¾ç‰‡å……æ»¡çª—å£è€Œä¸å˜å½¢ */
    max-width: 100%;
    max-height: 100%;
    overflow: hidden;
    /* é˜²æ­¢æº¢å‡º */
  
  }
  
  /* é¡¶éƒ¨æŒ‰é’®æ æ ·å¼ */
  .top-buttons {
    display: flex;
    margin-top: 10px;
    margin-bottom: 10px;
    gap: 10px;
  
  }
  
  .top-buttons button {
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    background-color: #2b3a4a;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .top-buttons button.active {
    background-color: #3c4d5e;
  }
  
  .top-buttons button:hover {
    opacity: 0.8;
  }
  </style>
    